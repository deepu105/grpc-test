import org.gradle.internal.os.OperatingSystem

/*
 * The protobuf-maven-plugin is used because
 * the rxgrpc plugin is a native Java one (not directly executable) and this is
 * not supported by the gradle plugin at the moment
 */

task generateProtobuf(type:Exec) {
    if (OperatingSystem.current().isWindows()) {
        commandLine 'cmd', '/c', '.mvn/mvnw.cmd generate-sources -f gradle/rxgrpc-pom.xml'
    } else {
        commandLine 'sh', '-c', 'sh .mvn/mvnw generate-sources -f gradle/rxgrpc-pom.xml'
    }
}

sourceSets {
    protobuf {
        java {
            srcDir file("${project.buildDir.path}/generated/source/proto/main/java")
        }
    }
}

compileJava.dependsOn generateProtobuf
compileJava.source += sourceSets.protobuf.java
